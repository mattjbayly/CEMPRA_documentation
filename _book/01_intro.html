<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CEMPRA Guidance Document - 1&nbsp; Introduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02_stressor_response.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_intro.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">CEMPRA Guidance Document</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CEMPRA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_stressor_response.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Stressor-Response Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_pathways_endpoints.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Modelling Pathways and Assessment Endpoints</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_initial_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Setup and Installation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_data_inputs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Inputs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_r_shiny_app.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R-Shiny Application</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_life_cycle_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Life Cycle Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_stressor_response_library.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Stressor-Response Library</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_case_study_applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Example Datasets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_r_package_tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">R Package Tutorials</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Concluding Remarks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Many species are under significant pressure from human development and resource use. These effects are coupled with existing pressures from climate change and natural disturbances. Collectively, these pressures can compound and interact to have cumulative effects on many species and ecosystems. Attempts have been made to quantify, map, and model cumulative effects across a landscape or region of interest to understand current conditions, high vs low-risk areas, and potential future conditions under different (hypothetical) development scenarios. However, the applicability of many analytical tools and frameworks is often constrained to specific geographies, study systems or regulatory requirements. In addition, many tools or frameworks are either too specific or over-generalized to be broadly transferable, causing researchers to develop their own models from scratch and duplicate efforts when undertaking cumulative effects (CE) assessments. In addition, most CE modelling tools merely rank the severity of local stressors using an additive or multiplicative scoring system based on the co-occurrence of multiple stressors (e.g., <span class="citation" data-cites="halpern2013assumptions">(<a href="references.html#ref-halpern2013assumptions" role="doc-biblioref">Halpern &amp; Fujita, 2013</a>)</span>). While this provides a useful index of local stressor magnitude, it provides limited insight into <em>how</em> ecological values will respond to stressor reduction, which requires predictive stressor-response functions.</p>
<p>The CEMPRA tool leverages (and automates) common data processing and analytical pathways reoccurring across numerous cumulative effects assessments. The development team behind the CEMPRA tool also recognizes that many cumulative effects assessments are collaborative and highly iterative. As such, an interactive web application was developed alongside an analytical R-package to facilitate the development of cumulative effects assessments in a workshop-like setting. The CEMPRA R-Shiny web application facilitates the inclusion and leadership of land stewards and decision-makers in the assessment and analytical process by working around a centralized interactive choropleth (heat) map. Key locations are represented by polygons on the map linked to interactive stressors and stressor-response relationships. Numerous interactive visualizations and summary tables are included within the tool to facilitate rapid “what if” scenario assessments. The CEMPRA tool does not include all possible options for advanced analytics. However, it can be a useful starting point to engage different user groups and work towards a shared understanding of key drivers, processes and opportunities for a target study system and region of interest.</p>
<p>The inspiration for the CEMPRA tool originated from many case studies centred around aquatic species-at-risk in Canada and is based on the Alberta Cumulative Effects model (<span class="citation" data-cites="macpherson2020alberta">(<a href="references.html#ref-macpherson2020alberta" role="doc-biblioref">L. MacPherson et al., 2020</a>)</span>, <span class="citation" data-cites="macpherson2023prioritizing">(<a href="references.html#ref-macpherson2023prioritizing" role="doc-biblioref">L. M. MacPherson et al., 2023</a>)</span>). However, the underlying framework is not explicitly bound to aquatic or terrestrial ecosystems. Aquatic ecosystems have remained the primary focus of the CEMPRA tool’s development in response to numerous contemporary priorities, including a) practical guidance for watershed management, b) recent amendments to the Fisheries Act prompting the consideration of cumulative effects (past and current), c) empowering practitioners with tools and resources to initialize collaborative cumulative effects assessments.</p>
<p>Key components of the CEMPRA include a focal study system (e.g., a target population), a focal area of interest (i.e., a target region with defined sub-areas, locations, or spatial units with different stressor levels), key stressors of interest (e.g., stream temperature, sedimentation, habitat loss), stressor-response functions linking key stressors to the focal population or species of interest, estimates of stressor magnitude levels across the target region of interest (e.g., current stressor conditions in the different spatial units), and different assessment endpoints (i.e., either the single-stage Joe model output or the life cycle model output) for data-rich and data-limited systems, and scenarios to represent in the model (i.e., future “what if” possibilities or alternative management scenarios).</p>
<p><strong>Core Components of the CEMPRA Tool:</strong></p>
<p>Unlike most CE models that score (weight) multiple stressors to generate an index of overlapping stressor levels at a given location (<span class="citation" data-cites="halpern2013assumptions">(<a href="references.html#ref-halpern2013assumptions" role="doc-biblioref">Halpern &amp; Fujita, 2013</a>)</span>), CEMPRA goes one step further to estimate the impact of a given stressor level on a target ecological response in any given spatial unit, based on local stressor levels. This “Joe” model structure requires the following components:</p>
<p><strong>Study System</strong>: In all applications of the CEMPRA tool, users should frame their assessment around a focal study system. Previous (and ongoing) applications of the Joe/CEMPRA model have included Athabasca Rainbow Trout (<span class="citation" data-cites="sullivan2017adaptive">(<a href="references.html#ref-sullivan2017adaptive" role="doc-biblioref">Sullivan, 2017</a>)</span>), Bull trout in Alberta (<span class="citation" data-cites="macpherson2023prioritizing">(<a href="references.html#ref-macpherson2023prioritizing" role="doc-biblioref">L. M. MacPherson et al., 2023</a>)</span>), Chinook Salmon in the Nicola Basin (<span class="citation" data-cites="pearsall2022nicola">(<a href="references.html#ref-pearsall2022nicola" role="doc-biblioref">Pearsall, 2022</a>)</span>) and the Plains Sucker in Southeastern Alberta (L. Jarvis, personal communication, February 23, 2023). On occasion, the term “study system” is used in conjunction with “cumulative effects” to describe a project or development within the Environmental Impact Assessment (EIA) literature. However, the CEMPRA tool uses specific user-defined valued ecosystem components as the study system. Usually, these are target populations or species, but occasionally they can be interpreted as broader entities with basic applications of CEMPRA where stressors are linked to “aquatic ecosystems”. If broader interpretations describe a study system, care should be taken to ensure that the stressor response functions are still interpretable and biologically relevant. For example, suppose CEMPRA is used for a multi-species assessment. In that case, creating species-specific stressor response curves and running scenarios for each species will likely be necessary.</p>
<p><strong>Stressors</strong>: Stressors and stressor-response functions are a core part of the CEMPRA tool. For the purposes of this tool, “stressors” can be defined broadly as “any environmental variable (e.g., temperature, sediment, predation, competition) that can induce a biological response (positive or negative)” (<span class="citation" data-cites="rosenfeld2024determinants">(<a href="references.html#ref-rosenfeld2024determinants" role="doc-biblioref">Rosenfeld et al., 2024</a>)</span>; <span class="citation" data-cites="jarvis2023process">(<a href="references.html#ref-jarvis2023process" role="doc-biblioref">Jarvis et al., 2023</a>)</span>). Stressors can include any user-defined environmental variable (or driver) that prevents the target species (or ecosystem component) from reaching a fully realized maximum system capacity that would presumably be possible without any harmful impacts. Stressors and stressor-response functions are described further in the next section.</p>
<p><strong>Stressor-Response Function:</strong> Stressor-response functions link stressors to the local abundance of the target species or value. The key defining components of stressor-response functions within the CEMPRA tools are that they represent quantitative linkages between raw stressor values and the predicted biological response. Stressor-response functions are equivalent to dose-response curves. They can also be interpreted as habitat suitability curves; however, the default assumption in most cumulative effects assessments is that target locations under evaluation have the capacity to support the study species in the absence of extreme stressor levels. Stressors and stressor-response functions are described further in the next section.</p>
<p><strong>Locations:</strong> The terms “locations”, “study areas”, “spatial units”, “polygons”, and/or “assessment units” are used interchangeably to describe discrete user-defined locations in the study region. Locations are represented in the CEMPRA tool as spatial polygons; linear features like stream reaches can also be represented as narrow polygons. Spatial units can be user-defined based on environmental heterogeneity and an area’s capacity to support the target species. Ideally, location breaks are chosen such that stressor values are largely homogenous within a spatial unit. Location breaks can also be defined to represent known (or suspected) subpopulations if they match management objectives or variations in stressor levels. In most cumulative effects assessments of aquatic ecosystems, location breaks will almost always be generated based on watersheds or subbasin boundaries since these natural geographic breaks often drive differences in key stressor values across the landscape.</p>
<p><strong>Assessment Endpoints</strong>: The ability to effectively link environmental stressors to a focal species using stressor-response functions is a core underlying function of the CEMPRA tool that differentiates it from many other cumulative effects models. Stressor-response functions allow stressor levels in a specific polygon to be used to predict the expected ecological response (system capacity). The CEMPRA tool provides two major workflows and assessment endpoints suitable for data-poor and data-rich systems. Stressor-response functions can be combined with stressor magnitudes in a polygon to predict local habitat capacity based on each stressor level, and the product of predicted habitat capacities for each stressor is used to generate an aggregate cumulative effect of all stressors on adult carrying capacity (the classical single-stage ‘Joe Model’); alternatively, stressors can be run through an integrated life cycle model where stressor-response functions are linked to vital rates (e.g., survivorship, capacity) for discrete life-history stages. The simplified roll-up (‘Joe Model’) is useful for data-limited species, but it also serves as a convenient framework for a rapid first-pass assessment to generate heatmaps of stressor severity. The integrated life cycle model has special utility for more data-rich systems where it’s possible to weight and understand stressors through the lens of a demographic stage-structured population framework. This can be especially important where some stressors will have disproportionate impacts on a specific life-history bottleneck and is appropriate for well-studies species with sufficient data to parameterize a population model.</p>
<p><strong>Scenarios:</strong> Scenarios represent unique user-defined management or recovery interventions (or the absence of action in a reference scenario) that aid the comparison of the outcome of different management actions. Scenarios (or scenario profiles) can include a combination of changes in one or more stressors at one or more locations to represent a hypothetical management action (or inaction). Scenarios can be implemented as changes to the stressor values (across locations) and/or changes to the stressor-response relationships, changing the underlying assumption of impact pathways (e.g., for a sensitivity analysis if there is uncertainty in stressor magnitudes or stress-or response functions).</p>
<p>The purpose of this user guide is to introduce these concepts in further detail with examples that demonstrate how they can be used to implement cumulative effects assessments in the CEMPRA framework. The following sections include setup instructions, a quick start guide, an overview of data inputs, and example cases. The intent is also to highlight the flexibility of the CEMPRA tool as a a generalizable and easy-to-use cumulative effects modelling framework that is adaptable to many different systems and/or species.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list" style="display: none">
<div id="ref-halpern2013assumptions" class="csl-entry" role="listitem">
Halpern, B. S., &amp; Fujita, R. (2013). Assumptions, challenges, and future directions in cumulative impact analysis. <em>Ecosphere</em>, <em>4</em>, 1–11.
</div>
<div id="ref-jarvis2023process" class="csl-entry" role="listitem">
Jarvis, L., Rosenfeld, J., Gonzalez-Espinosa, P., &amp; Enders, E. (2023). A process framework for integrating stressor-response functions into cumulative effects models. <em>Science of the Total Environment</em>, <em>XXX</em>, 167456.
</div>
<div id="ref-macpherson2023prioritizing" class="csl-entry" role="listitem">
MacPherson, L. M., Reilly, J. R., Neufeld, K. R., Sullivan, M. G., Paul, A. J., &amp; Johnston, F. D. (2023). Prioritizing bull trout recovery actions using a novel cumulative effects modelling framework. <em>Fisheries Management and Ecology</em>, 1–17.
</div>
<div id="ref-macpherson2020alberta" class="csl-entry" role="listitem">
MacPherson, L., Sullivan, M., Reilly, J., &amp; Paul, A. (2020). <em>Alberta’s fisheries sustainability assessment: A guide to assessing population status, and quantifying cumulative effects using the joe modelling technique</em>. Canadian Science Advisory Secretariat (CSAS).
</div>
<div id="ref-pearsall2022nicola" class="csl-entry" role="listitem">
Pearsall, et al. (2022). <em>Nicola watershed RAMS final report 2022: Nicola basin chinook risk assessment final report. A process developed with the nicola collaborative research and technical committee</em>.
</div>
<div id="ref-rosenfeld2024determinants" class="csl-entry" role="listitem">
Rosenfeld, J. S., Ayllón, D., Grant, J. W., Naman, S. M., Post, J. R., Matte, J.-M., et al. (2024). Determinants of productive capacity for stream salmonids. In J. Lobon-Cervia, P. Budy, &amp; R. Gresswell (Eds.), <em>Advances in the ecology of stream-dwelling salmonids</em> (pp. 1–12). Springer Life Sciences.
</div>
<div id="ref-sullivan2017adaptive" class="csl-entry" role="listitem">
Sullivan, M. (2017). <em>Adaptive management of athabasca rainbow trout; cumulative effects modelling and potential management actions</em>. Alberta Environment; Parks; Fisheries Management Branch.
</div>
</div>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">CEMPRA</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02_stressor_response.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Stressor-Response Functions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>