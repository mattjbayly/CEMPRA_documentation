<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Joe Model &amp; Shiny App – CEMPRA Guidance Document</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07_life_cycle_model.html" rel="next">
<link href="./05_data_inputs.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/cookie-consent/cookie-consent.js"></script>
<link href="site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70a47bd5681a7291082a5b9f83d58762.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3SJZ32N1H9"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-3SJZ32N1H9', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06_r_shiny_app.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Joe Model &amp; Shiny App</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">CEMPRA Guidance Document</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mattjbayly/CEMPRA_documentation/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CEMPRA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_stressor_response.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Stressor-Response Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_pathways_endpoints.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Modelling Pathways and Assessment Endpoints</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_initial_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Setup and Installation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_data_inputs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Inputs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_r_shiny_app.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Joe Model &amp; Shiny App</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_life_cycle_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Life Cycle Model (Population Model)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_stressor_response_library.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Stressor-Response Library</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_case_study_applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Example Datasets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_r_package_tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">R Package Tutorials</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Concluding Remarks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_interaction_matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Multi-Stressor Interaction Matrix</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_socio_economic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Socio-economic Evaluation of Restoration Actions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_formula_builder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">The Formula Builder</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#about" id="toc-about" class="nav-link active" data-scroll-target="#about"><span class="header-section-number">6.1</span> About</a></li>
  <li><a href="#upload-data" id="toc-upload-data" class="nav-link" data-scroll-target="#upload-data"><span class="header-section-number">6.2</span> Upload Data</a></li>
  <li><a href="#joe-model-and-main-overview" id="toc-joe-model-and-main-overview" class="nav-link" data-scroll-target="#joe-model-and-main-overview"><span class="header-section-number">6.3</span> Joe Model and Main Overview</a>
  <ul class="collapse">
  <li><a href="#map-window" id="toc-map-window" class="nav-link" data-scroll-target="#map-window"><span class="header-section-number">6.3.1</span> Map Window</a></li>
  <li><a href="#stressors" id="toc-stressors" class="nav-link" data-scroll-target="#stressors"><span class="header-section-number">6.3.2</span> Stressors</a></li>
  </ul></li>
  <li><a href="#joe-model-runs" id="toc-joe-model-runs" class="nav-link" data-scroll-target="#joe-model-runs"><span class="header-section-number">6.4</span> Joe Model Runs</a>
  <ul class="collapse">
  <li><a href="#system-capacity-plots" id="toc-system-capacity-plots" class="nav-link" data-scroll-target="#system-capacity-plots"><span class="header-section-number">6.4.1</span> System Capacity Plots</a></li>
  </ul></li>
  <li><a href="#adjust-stressor-magnitude" id="toc-adjust-stressor-magnitude" class="nav-link" data-scroll-target="#adjust-stressor-magnitude"><span class="header-section-number">6.5</span> Adjust Stressor Magnitude</a></li>
  <li><a href="#weighting-joe-model-result-scores" id="toc-weighting-joe-model-result-scores" class="nav-link" data-scroll-target="#weighting-joe-model-result-scores"><span class="header-section-number">6.6</span> Weighting Joe Model Result Scores</a></li>
  <li><a href="#download-data" id="toc-download-data" class="nav-link" data-scroll-target="#download-data"><span class="header-section-number">6.7</span> Download Data</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">6.8</span> </a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Joe Model &amp; Shiny App</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The R Shiny web application is a user-friendly interface for the CEMPRA powered by the <em>CEMPRA</em> R package. Users can access a working version R Shiny application hosted <a href="https://essa.shinyapps.io/CEMPRAShiny">here</a>. The following section is intended to walk new users through the components of the R Shiny web application.</p>
<section id="about" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="about"><span class="header-section-number">6.1</span> About</h2>
<p>When you first access the R Shiny web application for the CEMPRA, you will be automatically directed to the <strong>About</strong> page. This page contains a brief introduction to the application and the CEMPRA (Joe Model) tool, a list of contributors, and a list of features for users to explore. A tutorial video is also embedded on this webpage to guide users through the application.</p>
<div id="fig-figure14" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/image025.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.1: About page in the R Shiny web application. 1) Tutorial video for using the R Shiny application. 2) Brief introduction to the CEMPRA and associated life cycle model. 3) List of contributors to the CEMPRA. 4) List of features included in the R Shiny web application. 5) Menu for the R Shiny application
</figcaption>
</figure>
</div>
</section>
<section id="upload-data" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="upload-data"><span class="header-section-number">6.2</span> Upload Data</h2>
<p>If you would like to import a custom set of stressor-response functions, spatial polygons, or vital rates (for the life cycle model), select the <strong>Upload Data</strong> page in the menu on the left side of the screen. This page allows you to upload four key input files from your computer: the stressor-response workbook (.xlsx), the stressor-magnitude workbook (.xlsx), a spatial polygons file (.gpkg or .shp), and a life cycle profile (.csv). To upload a file from your computer, click “Browse…” on the toolbar below the associated file heading. Next, select the desired file from the file window and click “Open”. The file will begin to upload. A status bar will appear below the file name, indicating the upload status. Once the file has been successfully uploaded, the status bar will display “Upload complete”.</p>
<div id="fig-figure15" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/image026.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.2: Data upload page of the R Shiny web application. 1) Instructions for uploading files. 2) Location to upload stressor-response workbook (.xlsx). 3) Location to upload stressor magnitude workbook (.xlsx). 4) Location to upload spatial polygons file (.gpkg or .shp). 5) Location to upload life cycle profile (.csv).
</figcaption>
</figure>
</div>
</section>
<section id="joe-model-and-main-overview" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="joe-model-and-main-overview"><span class="header-section-number">6.3</span> Joe Model and Main Overview</h2>
<section id="map-window" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="map-window"><span class="header-section-number">6.3.1</span> Map Window</h3>
<p>The map window on the <strong>Map Overview</strong> page allows users to view stressor magnitudes and model results in a choropleth map based on the spatial polygons layer you imported. The map in the centre of the screen is interactive and allows users to scroll, zoom, and select individual polygons. When hovering over a polygon, users will see the name and HUC_ID of that polygon displayed directly above the map window. To select a polygon, click on it once. Selected polygons will appear in blue. Clicking on additional polygons will add to your selection. To deselect a polygon, click it again. The number of selected polygons (HUCs) will appear below the map window on the left-hand side. Click the “deselect all” button beside this text string to deselect all polygons.</p>
</section>
<section id="stressors" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="stressors"><span class="header-section-number">6.3.2</span> Stressors</h3>
<p>On the <strong>Map Overview</strong> page, users can view stressor-response relationships for each of the stressors included in the input stressor-response Excel workbook. A list of these stressors is on the screen’s right side. Clicking on the chart icon next to one of the stressors opens a pop-up window to view the stressor-response curve and raw stressor-response table associated with that specific stressor. You can edit cell values within the stressor-response table by double-clicking on the cell you want to edit. Any edits to the stressor-response table will automatically appear in the stressor-response curve.</p>
<div id="fig-figure16" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/image028.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.3: Stressor-response relationship pop-up window example. 1) Description of table and stressor-response curve. 2) Stressor-response curve plot. 3) Stressor-response curve input table. 4) List of stressors used in the CEMPRA (Joe Model).
</figcaption>
</figure>
</div>
</section>
</section>
<section id="joe-model-runs" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="joe-model-runs"><span class="header-section-number">6.4</span> Joe Model Runs</h2>
<p>To run the Joe Model, click the “Joe Model” button in the centre of the lower panel. In the pop-up window, you can select/deselect variables that you want to include/exclude in the Joe Model run. In addition, you can specify the number of simulations or batch runs you would like to conduct (in the “Number of Simulations” box), and you can provide a name for the simulation (in the “Name of this Simulation” box). When you are ready to run the Joe Model for all spatial polygons in the study area, click “Run the Joe Model”. Note there is currently no option to run the Joe Model for individual spatial polygons.</p>
<div id="fig-figure17" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/image029.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.4: Pop-up window for the Joe Model. 1) Variables to include/exclude from cumulative effects modelling. 2) Inputs for the number of simulations and the name of the simulation. 3) Button to run the Joe Model. 4) Button to bring up the pop-up window.
</figcaption>
</figure>
</div>
<section id="system-capacity-plots" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="system-capacity-plots"><span class="header-section-number">6.4.1</span> System Capacity Plots</h3>
<p>After running the Joe Model, a new section labelled “System Capacity Plots” will appear at the bottom of the map page. You can view tables and plots of the cumulative system capacity for selected watersheds (click “Selected watersheds”) or for all watersheds (click “All watersheds”) compared to the global mean system capacity across all simulations.</p>
<p>System capacity plots show the scaled probability output from the Joe Model from stochastic simulations.</p>
<div id="fig-figure18" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/image030.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.5: System capacity plots for eleven spatial units (locations) showing the cumulative system capacity scores (mean, median and scaled probability distributions).
</figcaption>
</figure>
</div>
</section>
</section>
<section id="adjust-stressor-magnitude" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="adjust-stressor-magnitude"><span class="header-section-number">6.5</span> Adjust Stressor Magnitude</h2>
<p>Users may wish to modify stressor values to represent recovery action or habitat loss. To view and edit stressor magnitudes for an individual spatial polygon, select the spatial polygon of interest and click “Adjust Magnitude” on the right-hand side of the lower panel. Next, review the mean system capacity in the pop-up window for one or more selected locations. Below this, a table containing all the stressors, their magnitudes and distributions will be displayed. Double-click on the desired cell to edit any of the values in this table. Adjust the mean value for each stressor (Mean), the standard deviation (SD), the distribution type (options are normal or lognormal), and the lower limit and upper limit (for stochastic simulations). Note that stressor names and system capacity values cannot be edited. If only one HUC is selected, values will appear in the table; however, if multiple HUCs are selected, the table will appear blank. When multiple HUCs are selected, all modified values will be shared across the selected HUCs. The mean system capacity is shown for selected HUCs to preview the model output.</p>
<div id="fig-figure19" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/image031.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.6: Example of single or multi-location stressor magnitude adjustment across spatial units.
</figcaption>
</figure>
</div>
</section>
<section id="weighting-joe-model-result-scores" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="weighting-joe-model-result-scores"><span class="header-section-number">6.6</span> Weighting Joe Model Result Scores</h2>
<p>Several alternative methods are available to integrate or add up Joe Model Cumulative System Capacity Scores across locations:</p>
<ul>
<li><strong>Summary Method 1</strong>: Cumulative System Capacity Scores are Summarized Across Locations with Equal Weighting</li>
<li><strong>Summary Method 2</strong>: Summarizing Cumulative System Capacity Scores Across Locations with a Locally Weighted Mean</li>
<li><strong>Summary Method 3</strong>: Multiply Joe Model Response Scores and Another Metric (e.g., area × density) to Weight Results Across Locations</li>
</ul>
<p><strong>Summary Method 1: Cumulative System Capacity Scores are Summarized Across Locations with Equal Weighting</strong></p>
<p><em>Overview:</em> When Joe Model Cumulative System Capacity result scores are summarized across locations (i.e., reach, polygon) and scenarios, by default the average score is calculated as an unweighted mean across locations (i.e., each location is weighted equally). This is appropriate if locations can be weighted equally or are assumed to be of equal value, size, etc. However, if this is not the case, then Summary Methods 2 or 3 can be used to summarize values as a weighted mean, and/or by taking the product of the scores and another weighting variable.</p>
<p><em>Calculation Method:</em> By default, Joe Model Cumulative System Capacity scores are summarized across locations with a simple unweighted mean. This is repeated for each MCMC batch replicate.</p>
<p><em>Applications:</em> If all locations represent approximately equal sizes or values, then this method is appropriate. In many instances, the Joe Model is run with locations that represent standardized hydrological units (watersheds), defined by a Hydrological Unit Code (HUC, 1-12). When using standardized hydrological units an unweighted mean is appropriate. In British Columbia, the Joe Model is occasionally run with Assessment Watersheds from the BC Freshwater Atlas. The Assessment Watersheds approximately represent standardized location units so summarizing values across locations with an unweighted mean is appropriate. In other instances, summaries are completed across discrete units as a part of an inventory where size and weighting are irrelevant (e.g., when comparing or summarizing status of populations or watersheds that are of equal intrinsic value).</p>
<p><strong>Summary Method 2: Summarizing Cumulative System Capacity Scores Across Locations with a Weighted Mean</strong></p>
<p><em>Overview:</em> In many instances, taking an unweighted mean will not be appropriate because locations differ considerably in size/value, or there is prior knowledge about habitat availability or weighting per location. For example, consider discrete watersheds that differ considerably in terms of their size and stream area. Additionally, consider instances where there is prior knowledge about the actual habitat availability within a location. Where possible we want to adjust Joe Model Cumulative System Capacity Scores so that the final value reported across locations is weighted by an appropriate metric such as habitat area which will represent a proxy for local population size or habitat capacity.</p>
<p><em>Calculation Method:</em> We can choose to summarize system capacity scores with a weighting variable. Usually, the metric chosen for weighting is an estimate of size or habitat area. The weighting metric is chosen by the user and generally represents one of the latent habitat metrics that have been added to the stressor magnitude database, but are not necessarily associated with a stressor-response function.</p>
<p><em>Applications:</em> Locations represent non-standardized units such as stream reaches, watershed polygons etc. and there is rationale for assigning location-specific weighting to score summaries, i.e., habitat capacity and local population size will be proportional to habitat area.</p>
<p><strong>Summary Method 3: Multiply Joe Model Response Scores and Another Metric (e.g., N) to Weight Results Across Locations</strong></p>
<p><em>Overview:</em> Ultimately, if we can (roughly) estimate habitat capacity (the hypothetical maximum number of individuals) at a location, then we can use the Joe Model system capacity response scores to estimate a change in habitat capacity by taking the product of the Joe Model response scores (0% to 100%, converted to 0 to 1) and an appropriate weighting variable (e.g., habitat capacity (N) by location, calculated as the product of habitat area × density). We can then report the final values in units of the weighting variable (e.g., Predicted Capacity, N). This calculation method provides a myriad of benefits since we can move away from reporting cumulative effect scores as a scale-independent “response percent” and report final values as more concrete units such as habitat capacity in terms of predicted population size (e.g., N) or habitat area (e.g., m²), etc. that are more easily interpretable to a wider audience.</p>
<p><em>Calculation Method:</em> By taking the product of the Joe Model response score and a weighting variable we convert final scores from a percent to units of the weighting variable. This method is similar to the basic Channel Unit Method described by <span class="citation" data-cites="cramer2009linking">(<a href="#ref-cramer2009linking" role="doc-biblioref">Cramer &amp; Ackerman, 2009</a>)</span> to estimate habitat suitability and cumulative effects. Where <em>i</em> is the individual location (channel unit, stream reach, etc.), and the equation represents that change in the capacity across locations as each location is multiplied by all location-specific stressors (scaled from 0 to 1). The sum is taken across all (<em>n</em>) locations and reported as a final value across batch replicates.</p>
<p><em>Applications:</em></p>
<ul>
<li><p><strong>Estimating a Quantitative Change in Habitat Carrying Capacity</strong>: If it is possible to estimate habitat capacity per location (e.g., by multiplying stream area (m²) and an estimate of fish density [hypothetical max N/m²]), we can roughly estimate carrying capacity (N = N/m² × m²). We can then use this metric as the weighting variable in the calculation to report the final score as a change in capacity.</p></li>
<li><p><strong>Estimating an Absolute Change in the Weighted Usable Area (WUA)</strong>: In many instream flow studies, WUA is described as the habitat area in a stream that is considered to be “functional” for a given species/life stage. The WUA value is reported in units of m² but is less than the total stream area. Various Habitat Suitability Index (HSI) curves for depth, velocity, cover, substrate, channel type etc. are multiplied together and then multiplied by the total stream wetted area to calculate the weighted usable area (WUA, m²). We can mimic this calculation in the toolbox if we treat HSI curves as stressors and then take the product of the Joe Model score (0-1) and stream area (m²).</p></li>
</ul>
<p>Various other creative methods can be integrated with any metric of interest if there is a rationale to report final values in a specific unit.</p>
<p>The following section describes how to implement each of the different calculation methods in the CEMPRA R-Shiny Application. First, we need to run the Joe Model in the Main Overview tab. After the model is run we can review results in the Scenario Results section. We can also apply weighting in the socio-economic module (<a href="#fig-figure19a" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-figure19a</span></a>).</p>
<div id="fig-figure19a" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure19a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/weighting_joe/fig1_where_to_apply_weighting_in_joe_model.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure19a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.7: Where to apply weighting in the Joe Model.
</figcaption>
</figure>
</div>
<p>Next, we can choose to summarize values across locations with either a weighted or unweighted mean (<a href="#fig-figure19b" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-figure19b</span></a>, <a href="#fig-figure19c" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-figure19c</span></a>). By default, the Joe Model results are summarized across locations with an unweighted mean (Summary Method 1). By adjusting the ‘Product or Weight’ input box to ‘Weighted Mean’ and selecting a specific weighting variable we can generate results using Summary Method 2 (a weighted mean).</p>
<div id="fig-figure19b" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure19b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/weighting_joe/fig2_joe_model_results_summarized_across_locations.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure19b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.8: Joe Model results summarized across locations with an unweighted mean (Summary Method 1).
</figcaption>
</figure>
</div>
<div id="fig-figure19c" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure19c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/weighting_joe/fig3_by_adjusting_product_or_weight.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure19c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.9: By adjusting the ‘Product or Weight’ input box to ‘Weighted Mean’ and selecting a specific weighting variable we can generate results using Summary Method 2 (a weighted mean).
</figcaption>
</figure>
</div>
<p>We can apply Summary Method 3 ‘Multiply Joe Model Response Scores and Another Metric to Summarize Results Across Locations’ by setting the ‘Product or Weight’ input select box to ‘Product’ (<a href="#fig-figure19d" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-figure19d</span></a>). We then need to select our metric that will be used as the weighting variables to multiply scores by. Remember to define the new y-axis units appropriately.</p>
<div id="fig-figure19d" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure19d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/weighting_joe/fig4_summary_method_3.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure19d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.10: Summary Method 3 ‘Multiply Joe Model Response Scores and Another Metric to Summarize Results Across Locations’.
</figcaption>
</figure>
</div>
</section>
<section id="download-data" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="download-data"><span class="header-section-number">6.7</span> Download Data</h2>
<p>On the <strong>Download Data</strong> page, you can either download the model input parameter files (i.e., the stressor-response workbook, stressor magnitude workbook, spatial polygons file, and life cycle profile) for offline revisions, or you can directly download the CEMPRA, or Life cycle model outputs for reporting purposes.</p>
<p><strong>Model Parameters</strong>: In some circumstances, it may be more convenient to download the stressor magnitude and response Excel workbooks, edit inputs for scenarios offline in Excel or other software and reupload.</p>
<p><strong>Model Exports</strong>: The model results can only be exported after the model is run. Export buttons will be disabled until the Joe Model or life cycle model (population model) has been run.</p>
<div id="fig-figure25" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figure25-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/image037.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figure25-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.11: Download the Data page of the R Shiny Application. 1) Model parameter files for download. 2) Model output files for download (CEMPRA and life cycle model).
</figcaption>
</figure>
</div>
</section>
<section id="section" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="section"><span class="header-section-number">6.8</span> </h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-cramer2009linking" class="csl-entry" role="listitem">
Cramer, S. P., &amp; Ackerman, N. K. (2009). Linking stream carrying capacity for salmonids to habitat features. <em>American Fisheries Society Symposium</em>, <em>71</em>, 225–254.
</div>
</div>
</section>

<p>Leave questions and comments below (via your GitHub account)</p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mattjbayly\.github\.io\/CEMPRA_documentation\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="mattjbayly/CEMPRA_documentation" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./05_data_inputs.html" class="pagination-link" aria-label="Data Inputs">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Inputs</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07_life_cycle_model.html" class="pagination-link" aria-label="Life Cycle Model (Population Model)">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Life Cycle Model (Population Model)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>